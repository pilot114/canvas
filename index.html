<!DOCTYPE html>
<html>
<head>
	<title>flat world</title>
</head>
<body>
	<div style="width: 1400px; height: 220px;">
		<h1>info:</h1>
		<div id="worldInfo"></div>
		<div id="countsInfo"></div>
		<div id="selectInfo" style="position:relative; top: -110px; left: 350px;"></div>
	</div>
	<canvas id="canvas" style="width: 1400px; height: 700px; background-color: #ddd;"></canvas>
</body>
<script type="text/javascript" src="./Helpers.js"></script>
<script type="text/javascript" src="./Animation.js"></script>
<script type="text/javascript" src="./Behavior.js"></script>
<script type="text/javascript" src="./Lifers.js"></script>
<script type="text/javascript" src="./World.js"></script>
<script type="text/javascript">

window.onload = function() {
	let canvas = document.getElementById('canvas');
    let context = canvas.getContext('2d');
	canvas.width = 1400;
	canvas.height = 700;

    canvas.addEventListener("click", function(event){
        let eventLocation = getEventLocation(this, event);
        world.selectByLocation(eventLocation);
    });


    let world = new World(canvas.width, canvas.height);
	createLifers(world, "Wolf", 20);
	createLifers(world, "Cow", 100);
	createLifers(world, "Grass", 150);

    // createRandomLifers(world, 1000);

    let fps = 60;
    let start = Date.now();
    let x = Date.now();
    let interval = 1000/fps;
    let delta;
    let now;

    (function draw() {
	    requestAnimationFrame(draw);

        now = Date.now();
        delta = now - x;
        x = now - delta % interval;

        if (delta > interval) {
            context.clearRect(0, 0, canvas.width, canvas.height);

            world.update(now-start);
            world.draw(context);

            createLifers(world, "Grass", 1);


            // info block
            document.getElementById('worldInfo').innerText = JSON.stringify({
				tick: world.tick,
				ms: world.ms,
                fps: Math.round(1000/(world.ms/world.tick)) // просто проверка
			});
            document.getElementById('countsInfo').innerText = JSON.stringify(world.getCounts());

            if (world.select) {
                let output = '';
                for (let property in world.select) {
                    if (typeof world.select[property] != 'function') {
                        output += property + ': ' + world.select[property]+"\n";
					}
                }

                document.getElementById('selectInfo').innerText = output;
			} else {
                document.getElementById('selectInfo').innerText = '';
			}
        }
	})();
}

</script>
</html>